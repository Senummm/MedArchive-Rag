# =============================================================================
# MedArchive RAG Environment Configuration
# =============================================================================
# Copy this file to .env and fill in your actual values
# Never commit .env to version control!

# -----------------------------------------------------------------------------
# Application Settings
# -----------------------------------------------------------------------------
ENVIRONMENT=development  # development, staging, production
LOG_LEVEL=INFO  # DEBUG, INFO, WARNING, ERROR, CRITICAL
APP_NAME=MedArchive-RAG
APP_VERSION=0.1.0

# -----------------------------------------------------------------------------
# API Service Configuration
# -----------------------------------------------------------------------------
API_HOST=0.0.0.0
API_PORT=8000
API_WORKERS=4
API_RELOAD=true  # Set to false in production

# CORS Settings (comma-separated origins)
CORS_ORIGINS=http://localhost:3000,http://localhost:8000

# -----------------------------------------------------------------------------
# LLM Services
# -----------------------------------------------------------------------------
# Groq API for ultra-fast inference (Llama-3.3-70B)
GROQ_API_KEY=your_groq_api_key_here
GROQ_MODEL=llama-3.3-70b-versatile
GROQ_MAX_TOKENS=4096
GROQ_TEMPERATURE=0.1  # Low temperature for factual medical responses

# LlamaParse for table-aware PDF parsing
LLAMAPARSE_API_KEY=your_llamaparse_api_key_here
LLAMAPARSE_RESULT_TYPE=markdown  # markdown, text
LLAMAPARSE_VERBOSE=false

# -----------------------------------------------------------------------------
# Vector Database (Qdrant)
# -----------------------------------------------------------------------------
# For local development (Docker Compose)
QDRANT_URL=http://qdrant:6333
QDRANT_GRPC_PORT=6334

# For Qdrant Cloud (uncomment and use in production)
# QDRANT_URL=https://your-cluster.aws.cloud.qdrant.io
# QDRANT_API_KEY=your_qdrant_cloud_api_key_here

# Collection Settings
QDRANT_COLLECTION_NAME=medarchive_documents
QDRANT_VECTOR_SIZE=1024  # For BAAI/bge-large-en-v1.5
QDRANT_DISTANCE_METRIC=Cosine

# Binary Quantization (for production performance)
QDRANT_USE_BINARY_QUANTIZATION=true

# -----------------------------------------------------------------------------
# Embedding Models
# -----------------------------------------------------------------------------
# Dense Vector Embeddings
EMBEDDING_MODEL=BAAI/bge-large-en-v1.5
EMBEDDING_DEVICE=cpu  # cpu or cuda

# Reranker Model (for two-stage retrieval)
RERANKER_MODEL=BAAI/bge-reranker-v2-m3
RERANKER_DEVICE=cpu

# -----------------------------------------------------------------------------
# Retrieval Configuration
# -----------------------------------------------------------------------------
# Stage 1: Wide Net Retrieval
RETRIEVAL_TOP_K=50  # Initial retrieval count
RETRIEVAL_SCORE_THRESHOLD=0.5

# Stage 2: Reranking
RERANK_TOP_K=5  # Final chunks sent to LLM
RERANK_ENABLED=true

# Hybrid Search Weights
DENSE_WEIGHT=0.7  # Semantic similarity weight
SPARSE_WEIGHT=0.3  # Keyword match (BM25) weight

# -----------------------------------------------------------------------------
# Document Processing (Ingestion Pipeline)
# -----------------------------------------------------------------------------
# Chunking Strategy
CHUNK_SIZE=1024  # Target chunk size in tokens
CHUNK_OVERLAP=200  # Overlap between chunks
MIN_CHUNK_SIZE=100  # Minimum viable chunk size

# PDF Source Directory
DOCUMENT_SOURCE_PATH=./data/document_store

# Sync Strategy
ENABLE_INCREMENTAL_SYNC=true  # Only process changed files
HASH_ALGORITHM=md5  # md5, sha256

# -----------------------------------------------------------------------------
# Data Storage
# -----------------------------------------------------------------------------
VECTOR_STORAGE_PATH=./data/vector_storage
DOCUMENT_METADATA_PATH=./data/document_store

# -----------------------------------------------------------------------------
# Security & Authentication
# -----------------------------------------------------------------------------
# API Key for internal service-to-service auth (optional)
INTERNAL_API_KEY=your_internal_api_key_here

# Azure Key Vault (for production)
# AZURE_KEY_VAULT_URL=https://your-vault.vault.azure.net/
# AZURE_TENANT_ID=your_tenant_id
# AZURE_CLIENT_ID=your_client_id
# AZURE_CLIENT_SECRET=your_client_secret

# -----------------------------------------------------------------------------
# Observability & Monitoring
# -----------------------------------------------------------------------------
# Arize Phoenix Tracing (Phase 5)
ENABLE_TRACING=false
PHOENIX_COLLECTOR_ENDPOINT=http://localhost:6006

# Structured Logging
LOG_FORMAT=json  # json or text
LOG_OUTPUT=stdout  # stdout, file, both

# -----------------------------------------------------------------------------
# CI/CD & Deployment
# -----------------------------------------------------------------------------
# Docker Registry
DOCKER_REGISTRY=your_acr_name.azurecr.io
DOCKER_IMAGE_TAG=latest

# Kubernetes Namespace (Phase 6)
K8S_NAMESPACE=medarchive-rag

# -----------------------------------------------------------------------------
# Feature Flags
# -----------------------------------------------------------------------------
ENABLE_ASYNC_PROCESSING=true
ENABLE_RATE_LIMITING=true
RATE_LIMIT_PER_MINUTE=60

# Cache Settings
ENABLE_QUERY_CACHE=true
CACHE_TTL_SECONDS=3600
